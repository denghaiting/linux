/****************************************Copyright (c)****************************************
                                                                                                                                             
                                           
                             Galaxywind Network System Co., Ltd.                                                    
                                                                                                                                
                                  http://www.galaxywind.com                                                             
                                                                                                                                             
                                   
 Author:        Y
 Date  :        2020-8-5
 *********************************************************************************************/

#ifndef __FREQ_ADJUST_H__
#define __FREQ_ADJUST_H__

#include "stm32f0xx.h"
#include "CMT2300A_spi.h"
#include "CMT2300A_reg.h"
#include "CMT2300A.h"
#include "CMT2300A_reg_bank.h"


#if 0 // 433

/*

					433.050(Start)			433.920MHz(Center)        434.790MHz(End)
					   *					    *                        *
					   |					    |                        |
		               +------------------------+------------------------+
					   |<------- 870KHz ------->|<------- 870KHz ------->|


 433.050(START)
    |
    |   433.120   433.220   433.320   433.420   433.520   433.620   433.720   433.820   433.920  ...
    |.070  ^         ^         ^         ^         ^         ^         ^         ^         ^                                 
    |  ^   | 433.170 | 433.270 | 433.370 | 433.470 | 433.570 | 433.670 | 433.770 | 433.870 |      
    |  |   |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |      
    |  |   |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
    |--+---+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+
    |  |50K| 50K|    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
    |  |   |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
    |-70 K-|- 100 K -|    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
    |  |   |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
    |  |   |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      
       *   *    *    *    *    *    *    *    *    *    *    *    *    *    *    *    *    *        
   CH: 0   1    2    3    4    5    6    7    8    9    10   11   12   13   14   15   16   17
         

                                                                                                434.790(END) 
                                                                                                   |
   ...   433.920   434.020   434.120   434.220   434.320   434.420   434.520   434.620   434.720   |    
            ^         ^         ^         ^         ^         ^         ^         ^         |      |                                       
            |         |         |         |         |         |         |         |         |      |
            | 433.970 | 434.070 | 434.170 | 434.270 | 434.370 | 434.470 | 434.570 | 434.670 |      |      
            |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |    ^    |      |      
            |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      |      
            +----+----+----+----+----+----+----+----+----+----+----+----+----+----+----+----|------|
            |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |50K |      |
            |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      |      
            |- 100 K -|    |    |    |    |    |    |    |    |    |    |    |    |- 100 K -|-70 K-|
            |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |    |      |      
            *    *    *    *    *    *    *    *    *    *    *    *    *    *    *    *    *       
   CH:      17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33





          S 0  1  2  3  4  5  6  7  8  9  10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  E
          | |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   |  
          | |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   |   
          | |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |   |   
			
            |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|
            |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|
[0,50)      |//|  2  |//|  5  |//|  8  |//|  11 |//|  14 |//|  17 |//|  20 |//|  23 |//|  26 |//|  29 |//|  32 |//|
            |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|  |  |//|
            |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|     |//|

          |/|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  || 
          |/|     |     |//|     |     |//|     |     |//|     |     |//|     |     |//|     |     |//|     |     || 
[50,100)  |/|     2     |//|     7     |//|     12    |//|     17    |//|     22    |//|     27    |//|     32    ||  
          |/|     |     |//|     |     |//|     |     |//|     |     |//|     |     |//|     |     |//|     |     || 
          |/|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  |//|  .  .  .  || 

          |/|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  ||                 
          |/|        |        |//|        |        |//|        |        |//|        |        |//|        |        ||
[100,150) |/|        3        |//|        10       |//|        17       |//|        24       |//|        32       ||
          |/|        |        |//|        |        |//|        |        |//|        |        |//|        |        ||
          |/|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  |//|  .  .  .  .  .  ||                 


            |//|  .  .  .  .  .  .  .  .  .  |//|  .  .  .  .  .  .  .  .  .  |//|  .  .  .  .  .  .  .  .  .  |//|
            |//|              |              |//|              |              |//|              |              |//|
[150,200]   |//|              6              |//|              17             |//|              28             |//|
            |//|              |              |//|              |              |//|              |              |//|
            |//|  .  .  .  .  .  .  .  .  .  |//|  .  .  .  .  .  .  .  .  .  |//|  .  .  .  .  .  .  .  .  .  |//|



信道划分规则:

(1) Deviation < 50K: 
	2, 5, 8, 11, 14, 17, 20, 23, 26, 29, 32
	<共11个CH, 间隔3个信道>
	
(2) 50 <= Deviation < 100K:
	2, 7, 12, 17, 22, 27, 32
	<共7个CH, 间隔5个信道>

(3) 100 <= Deviation < 150K:
	3, 10, 17, 24, 31
	<共5个CH, 间隔7个信道>
	
(4) 150 <= Deviation <= 200K:
    6, 17, 28
	<共3个CH, 间隔11个信道>

 */



enum {
	eCUSTOM_CH0 = 0, // 433.070 BASE_CH 基础频点
		
	eCUSTOM_CH1 = 1,
	eCUSTOM_CH2,
	eCUSTOM_CH3,
	eCUSTOM_CH4,
	eCUSTOM_CH5,
	eCUSTOM_CH6,
	eCUSTOM_CH7,
	eCUSTOM_CH8,
	eCUSTOM_CH9,
	eCUSTOM_CH10,
	
	eCUSTOM_CH11,
	eCUSTOM_CH12,
	eCUSTOM_CH13,
	eCUSTOM_CH14,
	eCUSTOM_CH15,
	eCUSTOM_CH16,
	eCUSTOM_CH17,  // 433.920 center_CH 中心频点
	eCUSTOM_CH18,
	eCUSTOM_CH19,
	eCUSTOM_CH20,
	
	eCUSTOM_CH21,
	eCUSTOM_CH22,
	eCUSTOM_CH23,
	eCUSTOM_CH24,
	eCUSTOM_CH25,
	eCUSTOM_CH26,
	eCUSTOM_CH27,
	eCUSTOM_CH28,
	eCUSTOM_CH29,
	eCUSTOM_CH30,
	
	eCUSTOM_CH31,
	eCUSTOM_CH32,
	eCUSTOM_CH33,

};

#define FH_OFFSET 		20 // (2.5KHz * 20 = 50KHz)
#define BASE_FREQ 		433070UL

#define DEFAULT_CH 		eCUSTOM_CH17







extern u8 cur_channel;


int set_custom_ch(u8 ch);
int custom_ch_init(void);



#else

// TODO: THIS IS 490.000

/*

					488.0MHz(Start)			 490.0MHz(Center)         492.0MHz(End)
					   *					    *                        *
					   |					    |                        |
		               +------------------------+------------------------+
					   |<-------- 2MHz  ------->|<-------- 2MHz  ------->|

         

   487.5(BASE_FREQ)                                                                                               490.0  
     ^  7.6 7.7 7.8 7.9 8.0 8.1 8.2 8.3 8.4 8.5 8.6 8.7 8.8 8.9 9.0 9.1 9.2 9.3 9.4 9.5 9.6 9.7 9.8 9.9  ^
     |   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   |
     |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |    
     +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
     |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |    
     |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |    
     |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |    
     *                   *                   *                   *                   *
CH:  0                   1                   2                   3                   4                   5
                                                                                               
                                                                                                   
   ...    490.0   
            ^                                   
            |  0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2.0 2.1 2.2
            |   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^   ^
            |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |   |     
            +---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+
            |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|    
            |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|    
            |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|   |   |   |   |///|    
            *                   *                   *                   *                   *
   CH:      5                   6                   7                   8                   9



 */



enum {
	eCUSTOM_CH0 = 0, // 433.070 BASE_CH 基础频点
		
	eCUSTOM_CH1 = 1,
	eCUSTOM_CH2,
	eCUSTOM_CH3,
	eCUSTOM_CH4,
	eCUSTOM_CH5, // 490.000MHz center_CH 中心频点
	eCUSTOM_CH6,
	eCUSTOM_CH7,
	eCUSTOM_CH8,
	eCUSTOM_CH9,

};

#define FH_OFFSET 		200 // (2.5KHz * 200 = 500KHz)
#define BASE_FREQ 		487500UL

#define DEFAULT_CH 		eCUSTOM_CH5

extern u8 cur_channel;


int set_custom_ch(u8 ch);
int custom_ch_init(void);

#endif

#endif
